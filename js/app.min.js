"use strict";const mapImgWrapper=document.querySelector("#placement__img-map-wrapper-js"),initMap=()=>{const e=new google.maps.Map(document.getElementById("map"),{zoom:17,center:{lat:59.93899,lng:30.32145}});new google.maps.Marker({position:{lat:59.938628,lng:30.3238},map:e,icon:"/img/map-marker.png"})};if(mapImgWrapper){const e=document.createElement("div");e.setAttribute("id","map"),e.setAttribute("class","placement__map"),mapImgWrapper.parentElement.replaceChild(e,mapImgWrapper);const t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdxiZ8JD-Awc3VOchAbkcA54-XHZJYkGY&callback=initMap",t.defer=!0,window.initMap=initMap,document.head.appendChild(t)}const KeyCode={left:"ArrowLeft",right:"ArrowRight"},prevElement=document.querySelector("#filter-panel__cost-title-js"),minCost=document.querySelector("#cost-min-js"),maxCost=document.querySelector("#cost-max-js"),createElement=e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild};if(prevElement&&minCost&&maxCost){const e=createElement('\n    <div class="filter-panel__cost-range">\n      <div class="filter-panel__cost-range-line">\n        <div\n          class="filter-panel__cost-point filter-panel__cost-point--min"\n          tabindex="0"\n          id="filter-panel__cost-point-min-js"\n        ></div>\n        <div\n          class="filter-panel__cost-point filter-panel__cost-point--max"\n          tabindex="0"\n          id="filter-panel__cost-point-max-js"\n        ></div>\n      </div>\n    </div>\n  '),t=e.querySelector(".filter-panel__cost-range-line"),n=e.querySelector("#filter-panel__cost-point-min-js"),o=e.querySelector("#filter-panel__cost-point-max-js"),i={MIN:{propName:"--min-percent",limitCostValue:0,limitPropValue:0,initPropValue:0,input:minCost,point:n},MAX:{propName:"--max-percent",limitCostValue:22059,limitPropValue:100,initPropValue:68,input:maxCost,point:o}},r=t=>parseFloat(e.style.getPropertyValue(t.propName).split("%")[0]),s=e=>{const t=parseInt(e.input.value,10);return Number.isNaN(t)?e.limitPropValue:t/i.MAX.limitCostValue*i.MAX.limitPropValue},p=e=>{const t=r(e);return Math.round(i.MAX.limitCostValue*t/i.MAX.limitPropValue)},l=e=>{const t=p(e);parseFloat(e.input.value)!==t&&(e.input.value=t)},a=(t,n)=>{e.style.setProperty(t.propName,n+"%"),l(t)},c=(e,t)=>{(t=t||s(e))<i.MIN.limitPropValue?t=i.MIN.limitPropValue:t>i.MAX.limitPropValue&&(t=i.MAX.limitPropValue),e===i.MIN&&t>r(i.MAX)?a(i.MAX,t):e===i.MAX&&t<r(i.MIN)&&a(i.MIN,t),a(e,t)},u=e=>{e.target===i.MIN.input?c(i.MIN):c(i.MAX)},d=e=>{const n=e.target===i.MIN.point?i.MIN:i.MAX,o=t.clientWidth,r=t.getBoundingClientRect().left,s=e=>{const t=Math.round((e.x-r)/o*100);c(n,t)},p=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",p)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",p)},m=e=>{const t=e.target===i.MIN.point?i.MIN:i.MAX;e.code===KeyCode.left?c(t,r(t)-1):e.code===KeyCode.right&&c(t,r(t)+1)};a(i.MIN,i.MIN.initPropValue),a(i.MAX,i.MAX.initPropValue),minCost.addEventListener("input",u),maxCost.addEventListener("input",u),n.addEventListener("mousedown",d),o.addEventListener("mousedown",d),n.addEventListener("keydown",m),o.addEventListener("keydown",m),prevElement.after(e)}const OPENED_CLASS="popup--opened",NO_JS_CLASS="popup--no-js",ERROR_CLASS="popup--error",ERROR_MESSAGE="Обязательное поле для заполнения",URL="https://echo.htmlacademy.ru/",popup=document.querySelector("#popup-js"),openPopupBtn=document.querySelector("#placement__description-button-js"),closePopupBtn=document.querySelector("#popup__close-button-js"),submitPopupFormBtn=document.querySelector("#popup__submit-js"),nameInput=document.querySelector("#popup-field-name-js"),emailInput=document.querySelector("#popup-field-email-js"),letterTextarea=document.querySelector("#popup-field-letter-js"),openPopup=e=>{e.preventDefault(),popup.classList.add(OPENED_CLASS),closePopupBtn.addEventListener("click",closePopup),submitPopupFormBtn.addEventListener("click",submitForm),nameInput.addEventListener("input",onFieldDataChanged),emailInput.addEventListener("input",onFieldDataChanged),letterTextarea.addEventListener("input",onFieldDataChanged)},closePopup=e=>{e&&e.preventDefault(),popup.classList.remove(OPENED_CLASS),popup.classList.remove(ERROR_CLASS),closePopupBtn.removeEventListener("click",closePopup),submitPopupFormBtn.removeEventListener("click",submitForm),nameInput.removeEventListener("input",onFieldDataChanged),emailInput.removeEventListener("input",onFieldDataChanged),letterTextarea.removeEventListener("input",onFieldDataChanged)},submitForm=e=>{e.preventDefault(),popup.classList.remove(ERROR_CLASS),isValidFormData()&&fetch(URL,{method:"POST"}).then(e=>{if(!e.ok)throw popup.classList.add(ERROR_CLASS),new Error(`_${e.status}: ${e.statusText}`);return closePopup(),e}).catch(e=>{throw popup.classList.add(ERROR_CLASS),e})},isValidField=e=>e.value.length>0?(e.setCustomValidity(""),!0):(e.setCustomValidity(ERROR_MESSAGE),!1),isValidFormData=()=>isValidField(nameInput)&&isValidField(emailInput)&&isValidField(letterTextarea),onFieldDataChanged=e=>{isValidField(e.target)};popup&&openPopupBtn&&closePopupBtn&&submitPopupFormBtn&&(popup.classList.remove(NO_JS_CLASS),openPopupBtn.addEventListener("click",openPopup));const sliderContainer=document.querySelector(".principles");if(sliderContainer){const e="principles__slide--active",t="principles__control-button--active",n=e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstChild},o=(o,i)=>{const r=n(`<li>\n        <button class="principles__control-button  ${i?"":t}" type="button">\n          <span class="visually-hidden">Принцип ${i+1}</span>\n        </button>\n      </li>`);return r.firstElementChild.addEventListener("click",n=>{const i=sliderContainer.querySelector("."+e);i!==o&&(sliderContainer.querySelector("."+t).classList.remove(t),i.classList.remove(e),o.classList.add(e),n.target.classList.add(t))}),i||o.classList.add(e),r},i=sliderContainer.querySelector("#principles__slider-js"),r=sliderContainer.querySelectorAll(".principles__slide"),s=n('<ul class="principles__control list-reset"></ul>');r.forEach((e,t)=>{e.classList.remove("principles__slide--no-js"),s.append(o(e,t))}),i.after(s)}const ACTIVE_SORT_TYPE_CLASS="sort-panel__type--active",ACTIVE_SORT_DIRECTION_CLASS="sort-panel__direction--active",sortTypeButtons=Array.from(document.querySelectorAll(".sort-panel__type")),sortDirectionButtons=Array.from(document.querySelectorAll(".sort-panel__direction")),onBtnClick=e=>{const t=e.target;let n="",o=[];sortTypeButtons.includes(t)?(n=ACTIVE_SORT_TYPE_CLASS,o=sortTypeButtons):(n=ACTIVE_SORT_DIRECTION_CLASS,o=sortDirectionButtons),o.filter(e=>e.classList.contains(n)).forEach(e=>e.classList.remove(n)),t.classList.add(n)};sortTypeButtons.forEach(e=>e.addEventListener("click",onBtnClick)),sortDirectionButtons.forEach(e=>e.addEventListener("click",onBtnClick));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsIm11bHRpcGxlLXJhbmdlLmpzIiwicG9wdXAuanMiLCJzbGlkZXIuanMiLCJzb3J0LmpzIl0sIm5hbWVzIjpbIm1hcEltZ1dyYXBwZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbml0TWFwIiwibWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsIk1hcmtlciIsInBvc2l0aW9uIiwiaWNvbiIsIm1hcENvbnRhaW5lciIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJwYXJlbnRFbGVtZW50IiwicmVwbGFjZUNoaWxkIiwic2NyaXB0Iiwic3JjIiwiZGVmZXIiLCJ3aW5kb3ciLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJLZXlDb2RlIiwibGVmdCIsInJpZ2h0IiwicHJldkVsZW1lbnQiLCJtaW5Db3N0IiwibWF4Q29zdCIsInRlbXBsYXRlIiwid3JhcHBlciIsImlubmVySFRNTCIsImZpcnN0RWxlbWVudENoaWxkIiwicmFuZ2VCbG9jayIsInJhbmdlTGluZSIsInBvaW50TWluIiwicG9pbnRNYXgiLCJDb3N0T2JqIiwiTUlOIiwicHJvcE5hbWUiLCJsaW1pdENvc3RWYWx1ZSIsImxpbWl0UHJvcFZhbHVlIiwiaW5pdFByb3BWYWx1ZSIsImlucHV0IiwicG9pbnQiLCJNQVgiLCJnZXRDdXJyZW50UHJvcFZhbHVlIiwiY29zdE9iaiIsInBhcnNlRmxvYXQiLCJzdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJzcGxpdCIsImNhbGN1bGF0ZVByb3BWYWx1ZSIsIm5ld0Nvc3RWYWx1ZSIsInBhcnNlSW50IiwidmFsdWUiLCJOdW1iZXIiLCJpc05hTiIsImNhbGN1bGF0ZUNvc3RWYWx1ZSIsImN1cnJlbnRQcm9wVmFsdWUiLCJNYXRoIiwicm91bmQiLCJjaGFuZ2VDb3N0VmFsdWUiLCJtYWtlU3luY2hyb25pemF0aW9uIiwibmV3UHJvcFZhbHVlIiwic2V0UHJvcGVydHkiLCJjaGFuZ2VQcm9wVmFsdWUiLCJvbkNoYW5nZUNvc3RWYWx1ZSIsImV2dCIsInRhcmdldCIsIm9uUG9pbnRNb3VzZURvd24iLCJkb3duRXZ0IiwibGluZVdpZHRoIiwiY2xpZW50V2lkdGgiLCJsZWZ0T2Zmc2V0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwib25Nb3ZlUG9pbnQiLCJtb3VzZUV2dCIsIngiLCJvblVwUG9pbnQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uUG9pbnRLZXlEb3duIiwia2V5RG93bkV2dCIsImNvZGUiLCJhZnRlciIsIk9QRU5FRF9DTEFTUyIsIk5PX0pTX0NMQVNTIiwiRVJST1JfQ0xBU1MiLCJFUlJPUl9NRVNTQUdFIiwiVVJMIiwicG9wdXAiLCJvcGVuUG9wdXBCdG4iLCJjbG9zZVBvcHVwQnRuIiwic3VibWl0UG9wdXBGb3JtQnRuIiwibmFtZUlucHV0IiwiZW1haWxJbnB1dCIsImxldHRlclRleHRhcmVhIiwib3BlblBvcHVwIiwicHJldmVudERlZmF1bHQiLCJjbGFzc0xpc3QiLCJhZGQiLCJjbG9zZVBvcHVwIiwic3VibWl0Rm9ybSIsIm9uRmllbGREYXRhQ2hhbmdlZCIsInJlbW92ZSIsImlzVmFsaWRGb3JtRGF0YSIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsInJlc3BvbnNlIiwib2siLCJFcnJvciIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJjYXRjaCIsImVycm9yIiwiaXNWYWxpZEZpZWxkIiwiZmllbGQiLCJsZW5ndGgiLCJzZXRDdXN0b21WYWxpZGl0eSIsInNsaWRlckNvbnRhaW5lciIsIlNMSURFX0FDVElWRV9DTEFTUyIsIkJVVFRPTl9BQ1RJVkVfQ0xBU1MiLCJuZXdFbGVtZW50IiwiZmlyc3RDaGlsZCIsImNyZWF0ZVNsaWRlckJ1dHRvbiIsInNsaWRlIiwibnVtYmVyIiwiYnV0dG9uV3JhcHBlciIsImN1cnJlbnRTbGlkZSIsImJlZm9yZUluc2VydEJsb2NrIiwic2xpZGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImJ1dHRvbnNDb250YWluZXIiLCJmb3JFYWNoIiwiaW5kZXgiLCJhcHBlbmQiLCJBQ1RJVkVfU09SVF9UWVBFX0NMQVNTIiwiQUNUSVZFX1NPUlRfRElSRUNUSU9OX0NMQVNTIiwic29ydFR5cGVCdXR0b25zIiwiQXJyYXkiLCJmcm9tIiwic29ydERpcmVjdGlvbkJ1dHRvbnMiLCJvbkJ0bkNsaWNrIiwic2VsZWN0ZWRCdG4iLCJhY3RpdmVDbGFzcyIsImJ0bnMiLCJpbmNsdWRlcyIsImZpbHRlciIsImJ0biIsImNvbnRhaW5zIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLE1BQUFBLGNBQUFDLFNBQUFDLGNBQUEsa0NBRUFDLFFBQUEsS0FFQSxNQUFBQyxFQUFBLElBQUFDLE9BQUFDLEtBQUFDLElBQUFOLFNBQUFPLGVBQUEsT0FBQSxDQUNBQyxLQUFBLEdBQ0FDLE9BQUEsQ0FDQUMsSUFBQSxTQUNBQyxJQUFBLFlBS0EsSUFBQVAsT0FBQUMsS0FBQU8sT0FBQSxDQUNBQyxTQUFBLENBQ0FILElBQUEsVUFDQUMsSUFBQSxTQUVBUixJQUFBQSxFQUNBVyxLQUFBLHlCQUlBLEdBQUFmLGNBQUEsQ0FDQSxNQUFBZ0IsRUFBQWYsU0FBQWdCLGNBQUEsT0FDQUQsRUFBQUUsYUFBQSxLQUFBLE9BQ0FGLEVBQUFFLGFBQUEsUUFBQSxrQkFDQWxCLGNBQUFtQixjQUFBQyxhQUFBSixFQUFBaEIsZUFFQSxNQUFBcUIsRUFBQXBCLFNBQUFnQixjQUFBLFVBQ0FJLEVBQUFDLElBQUEsdUdBQ0FELEVBQUFFLE9BQUEsRUFFQUMsT0FBQXJCLFFBQUFBLFFBRUFGLFNBQUF3QixLQUFBQyxZQUFBTCxHQ25DQSxNQUFBTSxRQUFBLENBQ0FDLEtBQUEsWUFDQUMsTUFBQSxjQUdBQyxZQUFBN0IsU0FBQUMsY0FBQSxnQ0FDQTZCLFFBQUE5QixTQUFBQyxjQUFBLGdCQUNBOEIsUUFBQS9CLFNBQUFDLGNBQUEsZ0JBRUFlLGNBQUFnQixJQUNBLE1BQUFDLEVBQUFqQyxTQUFBZ0IsY0FBQSxPQUdBLE9BRkFpQixFQUFBQyxVQUFBRixFQUVBQyxFQUFBRSxtQkFHQSxHQUFBTixhQUFBQyxTQUFBQyxRQUFBLENBQ0EsTUFpQkFLLEVBQUFwQixjQWpCQSxtZUFrQkFxQixFQUFBRCxFQUFBbkMsY0FBQSxrQ0FDQXFDLEVBQUFGLEVBQUFuQyxjQUFBLG9DQUNBc0MsRUFBQUgsRUFBQW5DLGNBQUEsb0NBRUF1QyxFQUFBLENBQ0FDLElBQUEsQ0FDQUMsU0FBQSxnQkFDQUMsZUFBQSxFQUNBQyxlQUFBLEVBQ0FDLGNBQUEsRUFDQUMsTUFBQWhCLFFBQ0FpQixNQUFBVCxHQUVBVSxJQUFBLENBQ0FOLFNBQUEsZ0JBQ0FDLGVBQUEsTUFDQUMsZUFBQSxJQUNBQyxjQUFBLEdBQ0FDLE1BQUFmLFFBQ0FnQixNQUFBUixJQUlBVSxFQUFBQyxHQUNBQyxXQUNBZixFQUFBZ0IsTUFBQUMsaUJBQUFILEVBQUFSLFVBQUFZLE1BQUEsS0FBQSxJQUlBQyxFQUFBTCxJQUNBLE1BQUFNLEVBQUFDLFNBQUFQLEVBQUFKLE1BQUFZLE1BQUEsSUFFQSxPQUFBQyxPQUFBQyxNQUFBSixHQUNBTixFQUFBTixlQUdBWSxFQUFBaEIsRUFBQVEsSUFBQUwsZUFBQUgsRUFBQVEsSUFBQUosZ0JBR0FpQixFQUFBWCxJQUNBLE1BQUFZLEVBQUFiLEVBQUFDLEdBRUEsT0FBQWEsS0FBQUMsTUFDQXhCLEVBQUFRLElBQUFMLGVBQUFtQixFQUFBdEIsRUFBQVEsSUFBQUosaUJBSUFxQixFQUFBZixJQUNBLE1BQUFNLEVBQUFLLEVBQUFYLEdBRUFDLFdBQUFELEVBQUFKLE1BQUFZLFNBQUFGLElBQ0FOLEVBQUFKLE1BQUFZLE1BQUFGLElBSUFVLEVBQUEsQ0FBQWhCLEVBQUFpQixLQUNBL0IsRUFBQWdCLE1BQUFnQixZQUFBbEIsRUFBQVIsU0FBQXlCLEVBQUEsS0FDQUYsRUFBQWYsSUFHQW1CLEVBQUEsQ0FBQW5CLEVBQUFpQixNQUNBQSxFQUFBQSxHQUFBWixFQUFBTCxJQUVBVixFQUFBQyxJQUFBRyxlQUNBdUIsRUFBQTNCLEVBQUFDLElBQUFHLGVBQ0F1QixFQUFBM0IsRUFBQVEsSUFBQUosaUJBQ0F1QixFQUFBM0IsRUFBQVEsSUFBQUosZ0JBR0FNLElBQUFWLEVBQUFDLEtBQUEwQixFQUFBbEIsRUFBQVQsRUFBQVEsS0FDQWtCLEVBQUExQixFQUFBUSxJQUFBbUIsR0FDQWpCLElBQUFWLEVBQUFRLEtBQUFtQixFQUFBbEIsRUFBQVQsRUFBQUMsTUFDQXlCLEVBQUExQixFQUFBQyxJQUFBMEIsR0FHQUQsRUFBQWhCLEVBQUFpQixJQUdBRyxFQUFBQyxJQUNBQSxFQUFBQyxTQUFBaEMsRUFBQUMsSUFBQUssTUFDQXVCLEVBQUE3QixFQUFBQyxLQUVBNEIsRUFBQTdCLEVBQUFRLE1BSUF5QixFQUFBQyxJQUNBLE1BQUF4QixFQUFBd0IsRUFBQUYsU0FBQWhDLEVBQUFDLElBQUFNLE1BQ0FQLEVBQUFDLElBQ0FELEVBQUFRLElBQ0EyQixFQUFBdEMsRUFBQXVDLFlBQ0FDLEVBQUF4QyxFQUFBeUMsd0JBQUFuRCxLQUVBb0QsRUFBQUMsSUFDQSxNQUFBYixFQUFBSixLQUFBQyxPQUFBZ0IsRUFBQUMsRUFBQUosR0FBQUYsRUFBQSxLQUVBTixFQUFBbkIsRUFBQWlCLElBR0FlLEVBQUEsS0FDQWxGLFNBQUFtRixvQkFBQSxZQUFBSixHQUNBL0UsU0FBQW1GLG9CQUFBLFVBQUFELElBR0FsRixTQUFBb0YsaUJBQUEsWUFBQUwsR0FDQS9FLFNBQUFvRixpQkFBQSxVQUFBRixJQUdBRyxFQUFBQyxJQUNBLE1BQUFwQyxFQUFBb0MsRUFBQWQsU0FBQWhDLEVBQUFDLElBQUFNLE1BQ0FQLEVBQUFDLElBQ0FELEVBQUFRLElBRUFzQyxFQUFBQyxPQUFBN0QsUUFBQUMsS0FDQTBDLEVBQUFuQixFQUFBRCxFQUFBQyxHQUFBLEdBQ0FvQyxFQUFBQyxPQUFBN0QsUUFBQUUsT0FDQXlDLEVBQUFuQixFQUFBRCxFQUFBQyxHQUFBLElBSUFnQixFQUFBMUIsRUFBQUMsSUFBQUQsRUFBQUMsSUFBQUksZUFDQXFCLEVBQUExQixFQUFBUSxJQUFBUixFQUFBUSxJQUFBSCxlQUVBZixRQUFBc0QsaUJBQUEsUUFBQWQsR0FDQXZDLFFBQUFxRCxpQkFBQSxRQUFBZCxHQUVBaEMsRUFBQThDLGlCQUFBLFlBQUFYLEdBQ0FsQyxFQUFBNkMsaUJBQUEsWUFBQVgsR0FFQW5DLEVBQUE4QyxpQkFBQSxVQUFBQyxHQUNBOUMsRUFBQTZDLGlCQUFBLFVBQUFDLEdBRUF4RCxZQUFBMkQsTUFBQXBELEdDdktBLE1BQUFxRCxhQUFBLGdCQUNBQyxZQUFBLGVBQ0FDLFlBQUEsZUFDQUMsY0FBQSxtQ0FDQUMsSUFBQSwrQkFFQUMsTUFBQTlGLFNBQUFDLGNBQUEsYUFDQThGLGFBQUEvRixTQUFBQyxjQUFBLHFDQUNBK0YsY0FBQWhHLFNBQUFDLGNBQUEsMkJBQ0FnRyxtQkFBQWpHLFNBQUFDLGNBQUEscUJBQ0FpRyxVQUFBbEcsU0FBQUMsY0FBQSx3QkFDQWtHLFdBQUFuRyxTQUFBQyxjQUFBLHlCQUNBbUcsZUFBQXBHLFNBQUFDLGNBQUEsMEJBRUFvRyxVQUFBOUIsSUFDQUEsRUFBQStCLGlCQUVBUixNQUFBUyxVQUFBQyxJQUFBZixjQUVBTyxjQUFBWixpQkFBQSxRQUFBcUIsWUFDQVIsbUJBQUFiLGlCQUFBLFFBQUFzQixZQUNBUixVQUFBZCxpQkFBQSxRQUFBdUIsb0JBQ0FSLFdBQUFmLGlCQUFBLFFBQUF1QixvQkFDQVAsZUFBQWhCLGlCQUFBLFFBQUF1QixxQkFHQUYsV0FBQWxDLElBQ0FBLEdBQ0FBLEVBQUErQixpQkFHQVIsTUFBQVMsVUFBQUssT0FBQW5CLGNBQ0FLLE1BQUFTLFVBQUFLLE9BQUFqQixhQUVBSyxjQUFBYixvQkFBQSxRQUFBc0IsWUFDQVIsbUJBQUFkLG9CQUFBLFFBQUF1QixZQUNBUixVQUFBZixvQkFBQSxRQUFBd0Isb0JBQ0FSLFdBQUFoQixvQkFBQSxRQUFBd0Isb0JBQ0FQLGVBQUFqQixvQkFBQSxRQUFBd0IscUJBR0FELFdBQUFuQyxJQUNBQSxFQUFBK0IsaUJBRUFSLE1BQUFTLFVBQUFLLE9BQUFqQixhQUVBa0IsbUJBQ0FDLE1BQUFqQixJQUFBLENBQ0FrQixPQUFBLFNBRUFDLEtBQUFDLElBQ0EsSUFBQUEsRUFBQUMsR0FHQSxNQUZBcEIsTUFBQVMsVUFBQUMsSUFBQWIsYUFFQSxJQUFBd0IsTUFBQSxJQUFBRixFQUFBRyxXQUFBSCxFQUFBSSxjQUtBLE9BRkFaLGFBRUFRLElBRUFLLE1BQUFDLElBR0EsTUFGQXpCLE1BQUFTLFVBQUFDLElBQUFiLGFBRUE0QixLQUtBQyxhQUFBQyxHQUNBQSxFQUFBL0QsTUFBQWdFLE9BQUEsR0FDQUQsRUFBQUUsa0JBQUEsS0FFQSxJQUdBRixFQUFBRSxrQkFBQS9CLGdCQUVBLEdBR0FpQixnQkFBQSxJQUNBVyxhQUFBdEIsWUFDQXNCLGFBQUFyQixhQUNBcUIsYUFBQXBCLGdCQUdBTyxtQkFBQXBDLElBQ0FpRCxhQUFBakQsRUFBQUMsU0FHQXNCLE9BQUFDLGNBQUFDLGVBQUFDLHFCQUNBSCxNQUFBUyxVQUFBSyxPQUFBbEIsYUFDQUssYUFBQVgsaUJBQUEsUUFBQWlCLFlDN0ZBLE1BQUF1QixnQkFBQTVILFNBQUFDLGNBQUEsZUFFQSxHQUFBMkgsZ0JBQUEsQ0FDQSxNQUFBQyxFQUFBLDRCQUNBQyxFQUFBLHFDQUVBOUcsRUFBQWdCLElBQ0EsTUFBQStGLEVBQUEvSCxTQUFBZ0IsY0FBQSxPQUdBLE9BRkErRyxFQUFBN0YsVUFBQUYsRUFFQStGLEVBQUFDLFlBR0FDLEVBQUEsQ0FBQUMsRUFBQUMsS0FDQSxNQVFBQyxFQUFBcEgsRUFSQSw0REFFQW1ILEVBQUEsR0FBQUwsc0VBQ0FLLEVBQUEsNENBdUJBLE9BakJBQyxFQUFBakcsa0JBQUFpRCxpQkFBQSxRQUFBYixJQUNBLE1BQUE4RCxFQUFBVCxnQkFBQTNILGNBQUEsSUFBQTRILEdBRUFRLElBQUFILElBQ0FOLGdCQUFBM0gsY0FBQSxJQUFBNkgsR0FDQXZCLFVBQUFLLE9BQUFrQixHQUNBTyxFQUFBOUIsVUFBQUssT0FBQWlCLEdBRUFLLEVBQUEzQixVQUFBQyxJQUFBcUIsR0FDQXRELEVBQUFDLE9BQUErQixVQUFBQyxJQUFBc0IsTUFJQUssR0FDQUQsRUFBQTNCLFVBQUFDLElBQUFxQixHQUdBTyxHQUdBRSxFQUFBVixnQkFBQTNILGNBQUEsMEJBQ0FzSSxFQUFBWCxnQkFBQVksaUJBQUEsc0JBRUFDLEVBQUF6SCxFQUFBLG9EQUVBdUgsRUFBQUcsUUFBQSxDQUFBUixFQUFBUyxLQUNBVCxFQUFBM0IsVUFBQUssT0FBQSw0QkFFQTZCLEVBQUFHLE9BQUFYLEVBQUFDLEVBQUFTLE1BSUFMLEVBQUE5QyxNQUFBaUQsR0N2REEsTUFBQUksdUJBQUEsMkJBQ0FDLDRCQUFBLGdDQUVBQyxnQkFBQUMsTUFBQUMsS0FBQWpKLFNBQUF3SSxpQkFBQSxzQkFDQVUscUJBQUFGLE1BQUFDLEtBQUFqSixTQUFBd0ksaUJBQUEsMkJBRUFXLFdBQUE1RSxJQUNBLE1BQUE2RSxFQUFBN0UsRUFBQUMsT0FDQSxJQUFBNkUsRUFBQSxHQUNBQyxFQUFBLEdBRUFQLGdCQUFBUSxTQUFBSCxJQUNBQyxFQUFBUix1QkFDQVMsRUFBQVAsa0JBRUFNLEVBQUFQLDRCQUNBUSxFQUFBSixzQkFHQUksRUFDQUUsT0FBQUMsR0FBQUEsRUFBQWxELFVBQUFtRCxTQUFBTCxJQUNBWCxRQUFBZSxHQUFBQSxFQUFBbEQsVUFBQUssT0FBQXlDLElBRUFELEVBQUE3QyxVQUFBQyxJQUFBNkMsSUFHQU4sZ0JBQUFMLFFBQUFlLEdBQUFBLEVBQUFyRSxpQkFBQSxRQUFBK0QsYUFDQUQscUJBQUFSLFFBQUFlLEdBQUFBLEVBQUFyRSxpQkFBQSxRQUFBK0QiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgbWFwSW1nV3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGFjZW1lbnRfX2ltZy1tYXAtd3JhcHBlci1qc2ApO1xuXG5jb25zdCBpbml0TWFwID0gKCkgPT4ge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWZcbiAgY29uc3QgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbWFwYCksIHtcbiAgICB6b29tOiAxNyxcbiAgICBjZW50ZXI6IHtcbiAgICAgIGxhdDogNTkuOTM4OTkwLFxuICAgICAgbG5nOiAzMC4zMjE0NTAsXG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmLCBuby11bnVzZWQtdmFyc1xuICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICBwb3NpdGlvbjoge1xuICAgICAgbGF0OiA1OS45Mzg2MjgsXG4gICAgICBsbmc6IDMwLjMyMzgwMCxcbiAgICB9LFxuICAgIG1hcCxcbiAgICBpY29uOiBgL2ltZy9tYXAtbWFya2VyLnBuZ2AsXG4gIH0pO1xufTtcblxuaWYgKG1hcEltZ1dyYXBwZXIpIHtcbiAgY29uc3QgbWFwQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XG4gIG1hcENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoYGlkYCwgYG1hcGApO1xuICBtYXBDb250YWluZXIuc2V0QXR0cmlidXRlKGBjbGFzc2AsIGBwbGFjZW1lbnRfX21hcGApO1xuICBtYXBJbWdXcmFwcGVyLnBhcmVudEVsZW1lbnQucmVwbGFjZUNoaWxkKG1hcENvbnRhaW5lciwgbWFwSW1nV3JhcHBlcik7XG5cbiAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgc2NyaXB0YCk7XG4gIHNjcmlwdC5zcmMgPSBgaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2pzP2tleT1BSXphU3lEZHhpWjhKRC1Bd2MzVk9jaEFia2NBNTQtWEhaSllrR1kmY2FsbGJhY2s9aW5pdE1hcGA7XG4gIHNjcmlwdC5kZWZlciA9IHRydWU7XG5cbiAgd2luZG93LmluaXRNYXAgPSBpbml0TWFwO1xuXG4gIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgS2V5Q29kZSA9IHtcbiAgbGVmdDogYEFycm93TGVmdGAsXG4gIHJpZ2h0OiBgQXJyb3dSaWdodGAsXG59O1xuXG5jb25zdCBwcmV2RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNmaWx0ZXItcGFuZWxfX2Nvc3QtdGl0bGUtanNgKTtcbmNvbnN0IG1pbkNvc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY29zdC1taW4tanNgKTtcbmNvbnN0IG1heENvc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjY29zdC1tYXgtanNgKTtcblxuY29uc3QgY3JlYXRlRWxlbWVudCA9ICh0ZW1wbGF0ZSkgPT4ge1xuICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XG4gIHdyYXBwZXIuaW5uZXJIVE1MID0gdGVtcGxhdGU7XG5cbiAgcmV0dXJuIHdyYXBwZXIuZmlyc3RFbGVtZW50Q2hpbGQ7XG59O1xuXG5pZiAocHJldkVsZW1lbnQgJiYgbWluQ29zdCAmJiBtYXhDb3N0KSB7XG4gIGNvbnN0IG1hcmt1cCA9IChgXG4gICAgPGRpdiBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1yYW5nZVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1yYW5nZS1saW5lXCI+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludCBmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtLW1pblwiXG4gICAgICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgICBpZD1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludC1taW4tanNcIlxuICAgICAgICA+PC9kaXY+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludCBmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtLW1heFwiXG4gICAgICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgICBpZD1cImZpbHRlci1wYW5lbF9fY29zdC1wb2ludC1tYXgtanNcIlxuICAgICAgICA+PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYCk7XG5cbiAgY29uc3QgcmFuZ2VCbG9jayA9IGNyZWF0ZUVsZW1lbnQobWFya3VwKTtcbiAgY29uc3QgcmFuZ2VMaW5lID0gcmFuZ2VCbG9jay5xdWVyeVNlbGVjdG9yKGAuZmlsdGVyLXBhbmVsX19jb3N0LXJhbmdlLWxpbmVgKTtcbiAgY29uc3QgcG9pbnRNaW4gPSByYW5nZUJsb2NrLnF1ZXJ5U2VsZWN0b3IoYCNmaWx0ZXItcGFuZWxfX2Nvc3QtcG9pbnQtbWluLWpzYCk7XG4gIGNvbnN0IHBvaW50TWF4ID0gcmFuZ2VCbG9jay5xdWVyeVNlbGVjdG9yKGAjZmlsdGVyLXBhbmVsX19jb3N0LXBvaW50LW1heC1qc2ApO1xuXG4gIGNvbnN0IENvc3RPYmogPSB7XG4gICAgTUlOOiB7XG4gICAgICBwcm9wTmFtZTogYC0tbWluLXBlcmNlbnRgLFxuICAgICAgbGltaXRDb3N0VmFsdWU6IDAsXG4gICAgICBsaW1pdFByb3BWYWx1ZTogMCxcbiAgICAgIGluaXRQcm9wVmFsdWU6IDAsXG4gICAgICBpbnB1dDogbWluQ29zdCxcbiAgICAgIHBvaW50OiBwb2ludE1pbixcbiAgICB9LFxuICAgIE1BWDoge1xuICAgICAgcHJvcE5hbWU6IGAtLW1heC1wZXJjZW50YCxcbiAgICAgIGxpbWl0Q29zdFZhbHVlOiAyMjA1OSxcbiAgICAgIGxpbWl0UHJvcFZhbHVlOiAxMDAsXG4gICAgICBpbml0UHJvcFZhbHVlOiA2OCxcbiAgICAgIGlucHV0OiBtYXhDb3N0LFxuICAgICAgcG9pbnQ6IHBvaW50TWF4LFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgZ2V0Q3VycmVudFByb3BWYWx1ZSA9IChjb3N0T2JqKSA9PiB7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoXG4gICAgICAgIHJhbmdlQmxvY2suc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShjb3N0T2JqLnByb3BOYW1lKS5zcGxpdChgJWApWzBdXG4gICAgKTtcbiAgfTtcblxuICBjb25zdCBjYWxjdWxhdGVQcm9wVmFsdWUgPSAoY29zdE9iaikgPT4ge1xuICAgIGNvbnN0IG5ld0Nvc3RWYWx1ZSA9IHBhcnNlSW50KGNvc3RPYmouaW5wdXQudmFsdWUsIDEwKTtcblxuICAgIGlmIChOdW1iZXIuaXNOYU4obmV3Q29zdFZhbHVlKSkge1xuICAgICAgcmV0dXJuIGNvc3RPYmoubGltaXRQcm9wVmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ld0Nvc3RWYWx1ZSAvIENvc3RPYmouTUFYLmxpbWl0Q29zdFZhbHVlICogQ29zdE9iai5NQVgubGltaXRQcm9wVmFsdWU7XG4gIH07XG5cbiAgY29uc3QgY2FsY3VsYXRlQ29zdFZhbHVlID0gKGNvc3RPYmopID0+IHtcbiAgICBjb25zdCBjdXJyZW50UHJvcFZhbHVlID0gZ2V0Q3VycmVudFByb3BWYWx1ZShjb3N0T2JqKTtcblxuICAgIHJldHVybiBNYXRoLnJvdW5kKFxuICAgICAgICBDb3N0T2JqLk1BWC5saW1pdENvc3RWYWx1ZSAqIGN1cnJlbnRQcm9wVmFsdWUgLyBDb3N0T2JqLk1BWC5saW1pdFByb3BWYWx1ZVxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgY2hhbmdlQ29zdFZhbHVlID0gKGNvc3RPYmopID0+IHtcbiAgICBjb25zdCBuZXdDb3N0VmFsdWUgPSBjYWxjdWxhdGVDb3N0VmFsdWUoY29zdE9iaik7XG5cbiAgICBpZiAocGFyc2VGbG9hdChjb3N0T2JqLmlucHV0LnZhbHVlKSAhPT0gbmV3Q29zdFZhbHVlKSB7XG4gICAgICBjb3N0T2JqLmlucHV0LnZhbHVlID0gbmV3Q29zdFZhbHVlO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBtYWtlU3luY2hyb25pemF0aW9uID0gKGNvc3RPYmosIG5ld1Byb3BWYWx1ZSkgPT4ge1xuICAgIHJhbmdlQmxvY2suc3R5bGUuc2V0UHJvcGVydHkoY29zdE9iai5wcm9wTmFtZSwgYCR7bmV3UHJvcFZhbHVlfSVgKTtcbiAgICBjaGFuZ2VDb3N0VmFsdWUoY29zdE9iaik7XG4gIH07XG5cbiAgY29uc3QgY2hhbmdlUHJvcFZhbHVlID0gKGNvc3RPYmosIG5ld1Byb3BWYWx1ZSkgPT4ge1xuICAgIG5ld1Byb3BWYWx1ZSA9IG5ld1Byb3BWYWx1ZSA/IG5ld1Byb3BWYWx1ZSA6IGNhbGN1bGF0ZVByb3BWYWx1ZShjb3N0T2JqKTtcblxuICAgIGlmIChuZXdQcm9wVmFsdWUgPCBDb3N0T2JqLk1JTi5saW1pdFByb3BWYWx1ZSkge1xuICAgICAgbmV3UHJvcFZhbHVlID0gQ29zdE9iai5NSU4ubGltaXRQcm9wVmFsdWU7XG4gICAgfSBlbHNlIGlmIChuZXdQcm9wVmFsdWUgPiBDb3N0T2JqLk1BWC5saW1pdFByb3BWYWx1ZSkge1xuICAgICAgbmV3UHJvcFZhbHVlID0gQ29zdE9iai5NQVgubGltaXRQcm9wVmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKGNvc3RPYmogPT09IENvc3RPYmouTUlOICYmIG5ld1Byb3BWYWx1ZSA+IGdldEN1cnJlbnRQcm9wVmFsdWUoQ29zdE9iai5NQVgpKSB7XG4gICAgICBtYWtlU3luY2hyb25pemF0aW9uKENvc3RPYmouTUFYLCBuZXdQcm9wVmFsdWUpO1xuICAgIH0gZWxzZSBpZiAoY29zdE9iaiA9PT0gQ29zdE9iai5NQVggJiYgbmV3UHJvcFZhbHVlIDwgZ2V0Q3VycmVudFByb3BWYWx1ZShDb3N0T2JqLk1JTikpIHtcbiAgICAgIG1ha2VTeW5jaHJvbml6YXRpb24oQ29zdE9iai5NSU4sIG5ld1Byb3BWYWx1ZSk7XG4gICAgfVxuXG4gICAgbWFrZVN5bmNocm9uaXphdGlvbihjb3N0T2JqLCBuZXdQcm9wVmFsdWUpO1xuICB9O1xuXG4gIGNvbnN0IG9uQ2hhbmdlQ29zdFZhbHVlID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQudGFyZ2V0ID09PSBDb3N0T2JqLk1JTi5pbnB1dCkge1xuICAgICAgY2hhbmdlUHJvcFZhbHVlKENvc3RPYmouTUlOKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hhbmdlUHJvcFZhbHVlKENvc3RPYmouTUFYKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgb25Qb2ludE1vdXNlRG93biA9IChkb3duRXZ0KSA9PiB7XG4gICAgY29uc3QgY29zdE9iaiA9IGRvd25FdnQudGFyZ2V0ID09PSBDb3N0T2JqLk1JTi5wb2ludFxuICAgICAgPyBDb3N0T2JqLk1JTlxuICAgICAgOiBDb3N0T2JqLk1BWDtcbiAgICBjb25zdCBsaW5lV2lkdGggPSByYW5nZUxpbmUuY2xpZW50V2lkdGg7XG4gICAgY29uc3QgbGVmdE9mZnNldCA9IHJhbmdlTGluZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuXG4gICAgY29uc3Qgb25Nb3ZlUG9pbnQgPSAobW91c2VFdnQpID0+IHtcbiAgICAgIGNvbnN0IG5ld1Byb3BWYWx1ZSA9IE1hdGgucm91bmQoKG1vdXNlRXZ0LnggLSBsZWZ0T2Zmc2V0KSAvIGxpbmVXaWR0aCAqIDEwMCk7XG5cbiAgICAgIGNoYW5nZVByb3BWYWx1ZShjb3N0T2JqLCBuZXdQcm9wVmFsdWUpO1xuICAgIH07XG5cbiAgICBjb25zdCBvblVwUG9pbnQgPSAoKSA9PiB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGBtb3VzZW1vdmVgLCBvbk1vdmVQb2ludCk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGBtb3VzZXVwYCwgb25VcFBvaW50KTtcbiAgICB9O1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihgbW91c2Vtb3ZlYCwgb25Nb3ZlUG9pbnQpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoYG1vdXNldXBgLCBvblVwUG9pbnQpO1xuICB9O1xuXG4gIGNvbnN0IG9uUG9pbnRLZXlEb3duID0gKGtleURvd25FdnQpID0+IHtcbiAgICBjb25zdCBjb3N0T2JqID0ga2V5RG93bkV2dC50YXJnZXQgPT09IENvc3RPYmouTUlOLnBvaW50XG4gICAgICA/IENvc3RPYmouTUlOXG4gICAgICA6IENvc3RPYmouTUFYO1xuXG4gICAgaWYgKGtleURvd25FdnQuY29kZSA9PT0gS2V5Q29kZS5sZWZ0KSB7XG4gICAgICBjaGFuZ2VQcm9wVmFsdWUoY29zdE9iaiwgZ2V0Q3VycmVudFByb3BWYWx1ZShjb3N0T2JqKSAtIDEpO1xuICAgIH0gZWxzZSBpZiAoa2V5RG93bkV2dC5jb2RlID09PSBLZXlDb2RlLnJpZ2h0KSB7XG4gICAgICBjaGFuZ2VQcm9wVmFsdWUoY29zdE9iaiwgZ2V0Q3VycmVudFByb3BWYWx1ZShjb3N0T2JqKSArIDEpO1xuICAgIH1cbiAgfTtcblxuICBtYWtlU3luY2hyb25pemF0aW9uKENvc3RPYmouTUlOLCBDb3N0T2JqLk1JTi5pbml0UHJvcFZhbHVlKTtcbiAgbWFrZVN5bmNocm9uaXphdGlvbihDb3N0T2JqLk1BWCwgQ29zdE9iai5NQVguaW5pdFByb3BWYWx1ZSk7XG5cbiAgbWluQ29zdC5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uQ2hhbmdlQ29zdFZhbHVlKTtcbiAgbWF4Q29zdC5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uQ2hhbmdlQ29zdFZhbHVlKTtcblxuICBwb2ludE1pbi5hZGRFdmVudExpc3RlbmVyKGBtb3VzZWRvd25gLCBvblBvaW50TW91c2VEb3duKTtcbiAgcG9pbnRNYXguYWRkRXZlbnRMaXN0ZW5lcihgbW91c2Vkb3duYCwgb25Qb2ludE1vdXNlRG93bik7XG5cbiAgcG9pbnRNaW4uYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIG9uUG9pbnRLZXlEb3duKTtcbiAgcG9pbnRNYXguYWRkRXZlbnRMaXN0ZW5lcihga2V5ZG93bmAsIG9uUG9pbnRLZXlEb3duKTtcblxuICBwcmV2RWxlbWVudC5hZnRlcihyYW5nZUJsb2NrKTtcbn1cbiIsIid1c2Ugc3RyaWN0JztcblxuY29uc3QgT1BFTkVEX0NMQVNTID0gYHBvcHVwLS1vcGVuZWRgO1xuY29uc3QgTk9fSlNfQ0xBU1MgPSBgcG9wdXAtLW5vLWpzYDtcbmNvbnN0IEVSUk9SX0NMQVNTID0gYHBvcHVwLS1lcnJvcmA7XG5jb25zdCBFUlJPUl9NRVNTQUdFID0gYNCe0LHRj9C30LDRgtC10LvRjNC90L7QtSDQv9C+0LvQtSDQtNC70Y8g0LfQsNC/0L7Qu9C90LXQvdC40Y9gO1xuY29uc3QgVVJMID0gYGh0dHBzOi8vZWNoby5odG1sYWNhZGVteS5ydS9gO1xuXG5jb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cC1qc2ApO1xuY29uc3Qgb3BlblBvcHVwQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYWNlbWVudF9fZGVzY3JpcHRpb24tYnV0dG9uLWpzYCk7XG5jb25zdCBjbG9zZVBvcHVwQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BvcHVwX19jbG9zZS1idXR0b24tanNgKTtcbmNvbnN0IHN1Ym1pdFBvcHVwRm9ybUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cF9fc3VibWl0LWpzYCk7XG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcG9wdXAtZmllbGQtbmFtZS1qc2ApO1xuY29uc3QgZW1haWxJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwb3B1cC1maWVsZC1lbWFpbC1qc2ApO1xuY29uc3QgbGV0dGVyVGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcG9wdXAtZmllbGQtbGV0dGVyLWpzYCk7XG5cbmNvbnN0IG9wZW5Qb3B1cCA9IChldnQpID0+IHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgcG9wdXAuY2xhc3NMaXN0LmFkZChPUEVORURfQ0xBU1MpO1xuXG4gIGNsb3NlUG9wdXBCdG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBjbG9zZVBvcHVwKTtcbiAgc3VibWl0UG9wdXBGb3JtQnRuLmFkZEV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgc3VibWl0Rm9ybSk7XG4gIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uRmllbGREYXRhQ2hhbmdlZCk7XG4gIGVtYWlsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkZpZWxkRGF0YUNoYW5nZWQpO1xuICBsZXR0ZXJUZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uRmllbGREYXRhQ2hhbmdlZCk7XG59O1xuXG5jb25zdCBjbG9zZVBvcHVwID0gKGV2dCkgPT4ge1xuICBpZiAoZXZ0KSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKE9QRU5FRF9DTEFTUyk7XG4gIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoRVJST1JfQ0xBU1MpO1xuXG4gIGNsb3NlUG9wdXBCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBjbG9zZVBvcHVwKTtcbiAgc3VibWl0UG9wdXBGb3JtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoYGNsaWNrYCwgc3VibWl0Rm9ybSk7XG4gIG5hbWVJbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uRmllbGREYXRhQ2hhbmdlZCk7XG4gIGVtYWlsSW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihgaW5wdXRgLCBvbkZpZWxkRGF0YUNoYW5nZWQpO1xuICBsZXR0ZXJUZXh0YXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKGBpbnB1dGAsIG9uRmllbGREYXRhQ2hhbmdlZCk7XG59O1xuXG5jb25zdCBzdWJtaXRGb3JtID0gKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKEVSUk9SX0NMQVNTKTtcblxuICBpZiAoaXNWYWxpZEZvcm1EYXRhKCkpIHtcbiAgICBmZXRjaChVUkwsIHtcbiAgICAgIG1ldGhvZDogYFBPU1RgLFxuICAgIH0pXG4gICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoRVJST1JfQ0xBU1MpO1xuXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBfJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBjbG9zZVBvcHVwKCk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZChFUlJPUl9DTEFTUyk7XG5cbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9KTtcbiAgfVxufTtcblxuY29uc3QgaXNWYWxpZEZpZWxkID0gKGZpZWxkKSA9PiB7XG4gIGlmIChmaWVsZC52YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgZmllbGQuc2V0Q3VzdG9tVmFsaWRpdHkoYGApO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmaWVsZC5zZXRDdXN0b21WYWxpZGl0eShFUlJPUl9NRVNTQUdFKTtcblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBpc1ZhbGlkRm9ybURhdGEgPSAoKSA9PiB7XG4gIHJldHVybiBpc1ZhbGlkRmllbGQobmFtZUlucHV0KVxuICAgICYmIGlzVmFsaWRGaWVsZChlbWFpbElucHV0KVxuICAgICYmIGlzVmFsaWRGaWVsZChsZXR0ZXJUZXh0YXJlYSk7XG59O1xuXG5jb25zdCBvbkZpZWxkRGF0YUNoYW5nZWQgPSAoZXZ0KSA9PiB7XG4gIGlzVmFsaWRGaWVsZChldnQudGFyZ2V0KTtcbn07XG5cbmlmIChwb3B1cCAmJiBvcGVuUG9wdXBCdG4gJiYgY2xvc2VQb3B1cEJ0biAmJiBzdWJtaXRQb3B1cEZvcm1CdG4pIHtcbiAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShOT19KU19DTEFTUyk7XG4gIG9wZW5Qb3B1cEJ0bi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsIG9wZW5Qb3B1cCk7XG59XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHNsaWRlckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5wcmluY2lwbGVzYCk7XG5cbmlmIChzbGlkZXJDb250YWluZXIpIHtcbiAgY29uc3QgU0xJREVfQUNUSVZFX0NMQVNTID0gYHByaW5jaXBsZXNfX3NsaWRlLS1hY3RpdmVgO1xuICBjb25zdCBCVVRUT05fQUNUSVZFX0NMQVNTID0gYHByaW5jaXBsZXNfX2NvbnRyb2wtYnV0dG9uLS1hY3RpdmVgO1xuXG4gIGNvbnN0IGNyZWF0ZUVsZW1lbnQgPSAodGVtcGxhdGUpID0+IHtcbiAgICBjb25zdCBuZXdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgZGl2YCk7XG4gICAgbmV3RWxlbWVudC5pbm5lckhUTUwgPSB0ZW1wbGF0ZTtcblxuICAgIHJldHVybiBuZXdFbGVtZW50LmZpcnN0Q2hpbGQ7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlU2xpZGVyQnV0dG9uID0gKHNsaWRlLCBudW1iZXIpID0+IHtcbiAgICBjb25zdCBidXR0b25UZW1wbGF0ZSA9IChcbiAgICAgIGA8bGk+XG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJwcmluY2lwbGVzX19jb250cm9sLWJ1dHRvbiAgJHtudW1iZXIgPyBgYCA6IEJVVFRPTl9BQ1RJVkVfQ0xBU1N9XCIgdHlwZT1cImJ1dHRvblwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwidmlzdWFsbHktaGlkZGVuXCI+0J/RgNC40L3RhtC40L8gJHtudW1iZXIgKyAxfTwvc3Bhbj5cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2xpPmBcbiAgICApO1xuXG4gICAgY29uc3QgYnV0dG9uV3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoYnV0dG9uVGVtcGxhdGUpO1xuICAgIGJ1dHRvbldyYXBwZXIuZmlyc3RFbGVtZW50Q2hpbGQuYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoZXZ0KSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50U2xpZGUgPSBzbGlkZXJDb250YWluZXIucXVlcnlTZWxlY3RvcihgLiR7U0xJREVfQUNUSVZFX0NMQVNTfWApO1xuXG4gICAgICBpZiAoY3VycmVudFNsaWRlICE9PSBzbGlkZSkge1xuICAgICAgICBzbGlkZXJDb250YWluZXIucXVlcnlTZWxlY3RvcihgLiR7QlVUVE9OX0FDVElWRV9DTEFTU31gKVxuICAgICAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKEJVVFRPTl9BQ1RJVkVfQ0xBU1MpO1xuICAgICAgICBjdXJyZW50U2xpZGUuY2xhc3NMaXN0LnJlbW92ZShTTElERV9BQ1RJVkVfQ0xBU1MpO1xuXG4gICAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoU0xJREVfQUNUSVZFX0NMQVNTKTtcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuYWRkKEJVVFRPTl9BQ1RJVkVfQ0xBU1MpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCFudW1iZXIpIHtcbiAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoU0xJREVfQUNUSVZFX0NMQVNTKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYnV0dG9uV3JhcHBlcjtcbiAgfTtcblxuICBjb25zdCBiZWZvcmVJbnNlcnRCbG9jayA9IHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGAjcHJpbmNpcGxlc19fc2xpZGVyLWpzYCk7XG4gIGNvbnN0IHNsaWRlcyA9IHNsaWRlckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKGAucHJpbmNpcGxlc19fc2xpZGVgKTtcblxuICBjb25zdCBidXR0b25zQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudChgPHVsIGNsYXNzPVwicHJpbmNpcGxlc19fY29udHJvbCBsaXN0LXJlc2V0XCI+PC91bD5gKTtcblxuICBzbGlkZXMuZm9yRWFjaCgoc2xpZGUsIGluZGV4KSA9PiB7XG4gICAgc2xpZGUuY2xhc3NMaXN0LnJlbW92ZShgcHJpbmNpcGxlc19fc2xpZGUtLW5vLWpzYCk7XG5cbiAgICBidXR0b25zQ29udGFpbmVyLmFwcGVuZChjcmVhdGVTbGlkZXJCdXR0b24oc2xpZGUsIGluZGV4KSk7XG4gIH0pO1xuXG5cbiAgYmVmb3JlSW5zZXJ0QmxvY2suYWZ0ZXIoYnV0dG9uc0NvbnRhaW5lcik7XG59XG4iLCIndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFDVElWRV9TT1JUX1RZUEVfQ0xBU1MgPSBgc29ydC1wYW5lbF9fdHlwZS0tYWN0aXZlYDtcbmNvbnN0IEFDVElWRV9TT1JUX0RJUkVDVElPTl9DTEFTUyA9IGBzb3J0LXBhbmVsX19kaXJlY3Rpb24tLWFjdGl2ZWA7XG5cbmNvbnN0IHNvcnRUeXBlQnV0dG9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLnNvcnQtcGFuZWxfX3R5cGVgKSk7XG5jb25zdCBzb3J0RGlyZWN0aW9uQnV0dG9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLnNvcnQtcGFuZWxfX2RpcmVjdGlvbmApKTtcblxuY29uc3Qgb25CdG5DbGljayA9IChldnQpID0+IHtcbiAgY29uc3Qgc2VsZWN0ZWRCdG4gPSBldnQudGFyZ2V0O1xuICBsZXQgYWN0aXZlQ2xhc3MgPSBgYDtcbiAgbGV0IGJ0bnMgPSBbXTtcblxuICBpZiAoc29ydFR5cGVCdXR0b25zLmluY2x1ZGVzKHNlbGVjdGVkQnRuKSkge1xuICAgIGFjdGl2ZUNsYXNzID0gQUNUSVZFX1NPUlRfVFlQRV9DTEFTUztcbiAgICBidG5zID0gc29ydFR5cGVCdXR0b25zO1xuICB9IGVsc2Uge1xuICAgIGFjdGl2ZUNsYXNzID0gQUNUSVZFX1NPUlRfRElSRUNUSU9OX0NMQVNTO1xuICAgIGJ0bnMgPSBzb3J0RGlyZWN0aW9uQnV0dG9ucztcbiAgfVxuXG4gIGJ0bnNcbiAgICAuZmlsdGVyKChidG4pID0+IGJ0bi5jbGFzc0xpc3QuY29udGFpbnMoYWN0aXZlQ2xhc3MpKVxuICAgIC5mb3JFYWNoKChidG4pID0+IGJ0bi5jbGFzc0xpc3QucmVtb3ZlKGFjdGl2ZUNsYXNzKSk7XG5cbiAgc2VsZWN0ZWRCdG4uY2xhc3NMaXN0LmFkZChhY3RpdmVDbGFzcyk7XG59O1xuXG5zb3J0VHlwZUJ1dHRvbnMuZm9yRWFjaCgoYnRuKSA9PiBidG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCBvbkJ0bkNsaWNrKSk7XG5zb3J0RGlyZWN0aW9uQnV0dG9ucy5mb3JFYWNoKChidG4pID0+IGJ0bi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsIG9uQnRuQ2xpY2spKTtcbiJdfQ==
